<!DOCTYPE html>
{% load static %}
{% load custom_tags %}
{% load pwa %}

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>

    {% progressive_web_app_meta %}
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/static/images/icons/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/images/icons/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/images/icons/11__iPad_Pro__10.5__iPad_Pro_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/static/images/icons/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/static/images/icons/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/static/images/icons/iPhone_14_Pro_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/static/images/icons/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/images/icons/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/static/images/icons/iPhone_14_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/static/images/icons/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/images/icons/10.5__iPad_Air_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/static/images/icons/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/images/icons/iPhone_11__iPhone_XR_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/images/icons/12.9__iPad_Pro_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/images/icons/10.2__iPad_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/images/icons/10.9__iPad_Air_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/images/icons/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/images/icons/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/images/icons/8.3__iPad_Mini_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/images/icons/10.5__iPad_Air_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/images/icons/11__iPad_Pro__10.5__iPad_Pro_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/static/images/icons/iPhone_14_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/images/icons/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/static/images/icons/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/images/icons/12.9__iPad_Pro_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/images/icons/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/static/images/icons/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/images/icons/iPhone_11__iPhone_XR_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/images/icons/10.2__iPad_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/static/images/icons/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/images/icons/10.9__iPad_Air_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/static/images/icons/iPhone_14_Pro_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/images/icons/8.3__iPad_Mini_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/static/images/icons/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png">
    
    <title>Zagreb Transport</title>
    <meta name="description" content="Uživo pratite tramvaje, autobuse i vlakove u Zagrebu!">

    <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" async>
    <link rel="stylesheet" href="{% static 'icons/icons.css' %}"/>
    <link rel="stylesheet" href="{% static 'leaflet/leaflet.css' %}"/>
    <script src="{% static 'leaflet/leaflet.js' %}"></script>
    <script src="{% static 'jquery/jquery-3.6.4.min.js' %}"></script>
    <script src="{% static 'a/a.js' %}"></script>

    {% comment %} <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" /> {% endcomment %}

</head>

<body style="height: 120vh;">

<div style="background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.4) 100%);
position: fixed; top: 0; left: 0; z-index: 10; height: env(safe-area-inset-top); width:100%;"></div>

<div class="mx-3" style="padding-bottom: calc(env(safe-area-inset-bottom) + 30px)">
    <div class="row">
        <div class="col-lg-4"></div>
        <div class="col-lg-4 d-grid gap-4">

            <div class="sticky-top" style="padding-top: max(env(safe-area-inset-top), 15px)">
                <div class="col p-1 d-grid gap-1 bg-secondary shadow" style="border-radius: 25.6px">
                    <div class="input-group active">
                        {% if request.path == '/' %}
                            <span class="input-group-text border-0 bg-transparent bold" style="font-size: 1.3rem; color: white;"
                            id="search-addon"><i class="bi bi-search"></i></span>
                        {% else %}
                            <button type="button" class="btn btn-primary bg-transparent border-0" style="font-size: 1.3rem; color: white;" onclick="window.history.back();">
                                <i class="bi bi-chevron-left"></i></button>
                        {% endif %}
                        <input id="search" type="search" class="form-control border-0 rounded-pill"
                            {% if station %}
                            placeholder="{{ station.stop_name }}"
                            {% else %}
                            placeholder="npr. Trg J. Jelačića"
                            {% endif %}
                            aria-label="Search"/>
                    </div>
                    <div id="results" class="col p-2" style="display:none;"></div>

                </div>
            </div>

            {% block content %}
            {% endblock %}

        </div>
        <div class="col-lg-4"></div>
    </div>
</div>

{% comment %} <div id="loading" class="modal">
    <div class="modal-dialog modal-fullscreen-sm-down">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div> {% endcomment %}
  

{% comment %} <div id="loading" style="position: fixed; top: 0; left: 0; z-index: 100; height:100%; width:100%; pointer-events:auto;">
    
</div> {% endcomment %}

<button type="button" class="btn btn-light rounded-circle shadow position-fixed bottom-0 end-0 m-3" data-bs-toggle="modal" data-bs-target="#info-modal"
    style="z-index: 99; aspect-ratio: 1 / 1;"><i class="bi bi-info-circle"></i></button>

<div id="info-modal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 29.6px">
            <div class="modal-body">
                {% if trip.bikes_allowed %}
                <p><span class="d-flex align-items-center"><i class="icon-bike"></i> - Bicikli dozvoljeni</span></p>
                {% endif %}
                {% if trip.wheelchair_accessible %}
                <p><span class="d-flex align-items-center"><i class="icon-wheelchair"></i> - Pristup invalidskim kolicima</span></p>
                {% endif %}
                {% if trip.bikes_allowed or trip.wheelchair_accessible %}
                <hr class="hr" />
                {% endif %}

                <p>
                    Zadnje ažuriranje prije <span class="badge bg-success">4</span> <span class="badge bg-warning">8</span>
                    <span class="badge bg-danger">15</span> <span class="badge bg-secondary">30</span> min
                </p>
                <p>
                    <span class="badge bg-secondary position-relative">
                        &#8226; &#8226; &#8226;
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill px-1 shadow bg-danger" style="font-size: 12px; z-index:99">+3&prime;</span>
                    </span>
                    &emsp;- Odstupanje od rasporeda
                </p>

                {% if trip or route %}
                <div class="text-muted">
                    <hr class="hr" />
                    <small>
                        <p>{{ route.agency.agency_name }}{{ trip.route.agency.agency_name }}
                        ({{ route.agency.static_feed.last_update|date:"d.m.Y" }}{{ trip.route.agency.static_feed.last_update|date:"d.m.Y" }})</p>

                        {% if route.agency.agency_phone or trip.route.agency.agency_phone %}
                        <p><i class="bi bi-telephone"></i>&nbsp;<a href="tel:{{ route.agency.agency_phone }}{{ trip.route.agency.agency_phone }}" class="text-decoration-none">
                            {{ route.agency.agency_phone }}{{ trip.route.agency.agency_phone }}
                        </a></p>
                        {% endif %}

                        {% if route.agency.agency_url or trip.route.agency.agency_url %}
                        <p><i class="bi bi-globe"></i>&nbsp;<a href="{{ route.agency.agency_url }}{{ trip.route.agency.agency_url }}" class="text-decoration-none">
                            {{ route.agency.agency_url }}{{ trip.route.agency.agency_url }}
                        </a></p>
                        {% endif %}

                        {% if route.agency.agency_email or trip.route.agency.agency_email %}
                        <p><i class="bi bi-envelope"></i>&nbsp;<a href="mailto:{{ route.agency.agency_email }}{{ trip.route.agency.agency_email }}" class="text-decoration-none">
                            {{ route.agency.agency_email }}{{ trip.route.agency.agency_email }}
                        </a></p>
                        {% endif %}

                        {% if route.agency.agency_fare_url or trip.route.agency.agency_fare_url %}
                        <p><i class="bi bi-cash-coin"></i>&nbsp;<a href="{{ route.agency.agency_fare_url }}{{ trip.route.agency.agency_fare_url }}" class="text-decoration-none">
                            Cijene karata
                        </a></p>
                        {% endif %}
                        
                    </small>
                </div>
                {% endif %}

                <div class="text-center text-muted">
                    <hr class="hr" />
                    <small class="text-center text-muted">&copy;Zagreb Transport {% now "Y" %}</small><br>
                    <small><a href="https://leafletjs.com/">Leaflet</a> | &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>
                        contributors &copy; <a href="https://carto.com/attributions">CARTO</a></small>
                </div>
                
            </div>
        </div>
    </div>
</div>

<script>
let timer;
const waitTime = 400;

const input = document.querySelector('#search');
input.addEventListener('keyup', (e) => {
    const text = e.currentTarget.value;
    
    clearTimeout(timer);
    
    timer = setTimeout(() => {
        search(text);
    }, waitTime);
});

function search(){
    let q = input.value;

    if (q.length > 0){
        const url = "/search_suggestions/?q=" + q;
        fetch(url)
          .then(
            response => response.json()
          ).then(
            json => populate(json)
          );
    } else {
        const res = document.getElementById("results");
        res.style.display = 'none';
    }
};

function populate(json){
    const res = document.getElementById("results");

    res.style.display = 'initial';
    res.innerHTML = '';

    if (json.data[0].length != 0){ res.innerHTML += '<div class="list-group-item bg-transparent text-white-50 p-2" aria-current="true">Vlak</div>'; };
    for (const st of json.data[0]){
        let name = st[0];
        let id = st[1];
        res.innerHTML += '<a href="/station/?id=' + id + '" class="list-group-item bg-transparent text-white p-2">&emsp;' + name + '</a>';
    };

    if (json.data[1].length != 0){ res.innerHTML += '<div class="list-group-item bg-transparent text-white-50 p-2" aria-current="true">Tramvaji</div>'; };
    for (const st of json.data[1]){
        let name = st[0];
        let id = st[1];
        res.innerHTML += '<a href="/station/?id=' + id + '" class="list-group-item bg-transparent text-white p-2">&emsp;' + name + '</a>';
    };

    if (json.data[2].length != 0){ res.innerHTML += '<div class="list-group-item bg-transparent text-white-50 p-2" aria-current="true">Autobusi</div>'; };
    for (const st of json.data[2]){
        let name = st[0];
        let id = st[1];
        res.innerHTML += '<a href="/station/?id=' + id + '" class="list-group-item bg-transparent text-white p-2">&emsp;' + name + '</a>';
    };

    if (json.data[3].length != 0){ res.innerHTML += '<div class="list-group-item bg-transparent text-white-50 p-2" aria-current="true">Linije</div>'; };
    for (const st of json.data[3]){
        if (st[0].length > 0){
            var name = st[0] + ' - ' + st[1];
        } else {
            var name = st[1];
        };
        
        let id = st[2];
        res.innerHTML += '<a href="/route/?id=' + id + '" class="list-group-item bg-transparent text-white p-2">&emsp;' + name + '</a>';
    };

};

function save_stop(id){
    const url = "/save_stop/?id=" + id;
    fetch(url)
    .then(
        response => response.json()
    ).then(
        json => save_stop_response(json.action, id)
    );
};

function save_stop_response(action, id){
    const fill = document.getElementById("save-fill-" + id);
    const nfill = document.getElementById("save-nfill-" + id);

    if (action == 1){
        fill.style.display = 'initial';
        nfill.style.display = 'none';

    } else if (action == 0){
        fill.style.display = 'none';
        nfill.style.display = 'initial';
    }
};

{% comment %} window.addEventListener("beforeunload", function (event) {
    $("#loading").modal("show");
}); {% endcomment %}

{% comment %} const isIos = () => {
    const userAgent = window.navigator.userAgent.toLowerCase();
    return /iphone|ipad|ipod/.test( userAgent );
  }
  // Detects if device is in standalone mode
  const isInStandaloneMode = () => ('standalone' in window.navigator) && (window.navigator.standalone);
  
  // Checks if should display install popup notification:
  if (isIos() && !isInStandaloneMode()) {
    $("#install-popup").modal({show: true});
  } else {$("#install-popup").modal({show: true}); } {% endcomment %}
  
</script>

<style>
    .marker-label {
        min-width: 104px;
        left: -46px;
        top: 18px;
        text-align: center;
        font-weight: bold;
        font-size: 9px;
        min-height: 1.2em;
      }
</style>

</body>
</html>